/*
 *	 Constellation Platform 1.8
 *	 Web site: http://www.myConstellation.io
 *	 Copyright (C) 2014-2016 - Sebastien Warin <http://sebastien.warin.fr>
 *	 All Rights Reserved.
 *	
 *	 NOTICE:  All information contained herein is, and remains the property of Sebastien Warin.
 *	 The intellectual and technical concepts contained herein are proprietary to Sébastien Warin.
 *	 Dissemination of this information or reproduction of this material is strictly forbidden
 *   unless prior written permission is obtained from Sébastien Warin.
*/
!function(e,r,n){"use strict";function t(r,n){return function(){n.apply(r,e.makeArray(arguments))}}function o(r,n){var o,a,s,u,i;for(o in r)if(r.hasOwnProperty(o)){if(a=r[o],!a.hubName)continue;i=n?a.on:a.off;for(s in a.client)if(a.client.hasOwnProperty(s)){if(u=a.client[s],!e.isFunction(u))continue;i.call(a,s,t(a,u))}}}if("function"!=typeof e.signalR)throw new Error("SignalR: SignalR is not loaded. Please ensure jquery.signalR-x.js is referenced before ~/signalr/js.");var a=e.signalR,s={};e.hubConnection.prototype.createHubProxies=function(r){var n={};return this.starting(function(){o(n,!0),this._registerSubscribedHubs()}).disconnected(function(){o(n,!1)}),"consumerHub"==r?(n.Consumer=this.createHubProxy("consumerHub"),n.Consumer.client={onReceiveMessage:function(e){return n.Consumer.on("ReceiveMessage",e)},registerMessageCallback:function(e,r){return n.Consumer.client.onReceiveMessage(function(n){r&&e==n.Key&&r(n)})},onUpdateStateObject:function(e){return n.Consumer.on("UpdateStateObject",e)},registerStateObjectLink:function(e,r,t,o,a){var s=n.Consumer.client.onUpdateStateObject(function(n){!a||n.SentinelName!=e&&"*"!=e||n.PackageName!=r&&"*"!=r||n.Name!=t&&"*"!=t||n.Type!=o&&"*"!=o||a(n)});return n.Consumer.server.requestSubscribeStateObjects(e,r,t,o),s}},n.Consumer.server={requestStateObjects:function(r,t,o,a){return n.Consumer.invoke.apply(n.Consumer,e.merge(["RequestStateObjects"],e.makeArray(arguments)))},sendMessage:function(r,t,o){return n.Consumer.invoke.apply(n.Consumer,e.merge(["SendMessage"],e.makeArray(arguments)))},sendMessageWithSaga:function(e,r,t,o){return"undefined"==typeof e.SagaId&&(e.SagaId=(new Date).getTime()+Math.floor(1e3*Math.random())),n.Consumer.client.onReceiveMessage(function(r){o&&r.Scope.SagaId==e.SagaId&&o(r)}),n.Consumer.server.sendMessage(e,r,t)},subscribeMessages:function(r){return n.Consumer.invoke.apply(n.Consumer,e.merge(["SubscribeMessages"],e.makeArray(arguments)))},subscribeStateObjects:function(r,t,o,a){return n.Consumer.invoke.apply(n.Consumer,e.merge(["SubscribeStateObjects"],e.makeArray(arguments)))},unSubscribeMessages:function(r){return n.Consumer.invoke.apply(n.Consumer,e.merge(["UnSubscribeMessages"],e.makeArray(arguments)))},unSubscribeStateObjects:function(r,t,o,a){return n.Consumer.invoke.apply(n.Consumer,e.merge(["UnSubscribeStateObjects"],e.makeArray(arguments)))},requestSubscribeStateObjects:function(e,r,t,o){return n.Consumer.server.requestStateObjects(e,r,t,o),n.Consumer.server.subscribeStateObjects(e,r,t,o)}}):"controlHub"==r&&(n.Controller=this.createHubProxy("controlHub"),n.Controller.client={onReceiveLogMessage:function(e){return s.PackagesLog=!0,n.Controller.on("ReceiveLog",e)},onUpdateSentinel:function(e){return s.Sentinels=!0,n.Controller.on("UpdateSentinel",e)},onUpdateSentinelsList:function(e){return n.Controller.on("UpdateSentinelsList",e)},onReportPackageState:function(e){return s.PackagesState=!0,n.Controller.on("ReportPackageState",e)},onReportPackageUsage:function(e){return s.PackagesUsage=!0,n.Controller.on("ReportPackageUsage",e)},onUpdatePackageList:function(e){return n.Controller.on("UpdatePackageList",e)},onUpdatePackageDescriptor:function(e){return n.Controller.on("UpdatePackageDescriptor",e)}},n.Controller.server={addToControlGroup:function(r){return n.Controller.invoke.apply(n.Controller,e.merge(["AddToControlGroup"],e.makeArray(arguments)))},purgeStateObjects:function(r,t,o,a){return n.Controller.invoke.apply(n.Controller,e.merge(["PurgeStateObjects"],e.makeArray(arguments)))},reloadServerConfiguration:function(r){return n.Controller.invoke.apply(n.Controller,e.merge(["ReloadServerConfiguration"],e.makeArray(arguments)))},reload:function(r,t){return n.Controller.invoke.apply(n.Controller,e.merge(["Reload"],e.makeArray(arguments)))},removeToControlGroup:function(r){return n.Controller.invoke.apply(n.Controller,e.merge(["RemoveToControlGroup"],e.makeArray(arguments)))},requestPackageDescriptor:function(r){return n.Controller.invoke.apply(n.Controller,e.merge(["RequestPackageDescriptor"],e.makeArray(arguments)))},requestPackagesList:function(r){return n.Controller.invoke.apply(n.Controller,e.merge(["RequestPackagesList"],e.makeArray(arguments)))},requestSentinelsList:function(){return n.Controller.invoke.apply(n.Controller,e.merge(["RequestSentinelsList"],e.makeArray(arguments)))},requestSentinelUpdates:function(){return n.Controller.invoke.apply(n.Controller,e.merge(["RequestSentinelUpdates"],e.makeArray(arguments)))},restart:function(r,t){return n.Controller.invoke.apply(n.Controller,e.merge(["Restart"],e.makeArray(arguments)))},start:function(r,t){return n.Controller.invoke.apply(n.Controller,e.merge(["Start"],e.makeArray(arguments)))},stop:function(r,t){return n.Controller.invoke.apply(n.Controller,e.merge(["Stop"],e.makeArray(arguments)))},updatePackageSettings:function(r,t){return n.Controller.invoke.apply(n.Controller,e.merge(["UpdatePackageSettings"],e.makeArray(arguments)))}}),n},a.createConstellationConsumer=function(r,n,t){return a.consumerHub=e.hubConnection(r,{useDefaultPath:!0,qs:{SentinelName:"Consumer",PackageName:t,AccessKey:n}}),e.extend(a,a.consumerHub.createHubProxies("consumerHub")),a.Consumer},a.createConstellationController=function(r,n,t){return a.controlHub=e.hubConnection(r,{useDefaultPath:!0,qs:{SentinelName:"Controller",PackageName:t,AccessKey:n}}),a.controlHub.stateChanged(function(r){if(r.newState===e.signalR.connectionState.connected)for(var n in s)1==s[n]&&a.Controller.server.addToControlGroup(n)}),e.extend(a,a.controlHub.createHubProxies("controlHub")),a.Controller}}(window.jQuery,window);